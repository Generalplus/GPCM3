#include "GPCM3_FM1.h"

const uint64_t T_BitEnable_Table[] ={
	0x0000000000000001, 0x0000000000000002, 0x0000000000000004, 0x0000000000000008,
	0x0000000000000010, 0x0000000000000020, 0x0000000000000040, 0x0000000000000080,
	0x0000000000000100, 0x0000000000000200, 0x0000000000000400, 0x0000000000000800,
	0x0000000000001000, 0x0000000000002000, 0x0000000000004000, 0x0000000000008000,
	0x0000000000010000, 0x0000000000020000, 0x0000000000040000, 0x0000000000080000,
	0x0000000000100000, 0x0000000000200000, 0x0000000000400000, 0x0000000000800000,
	0x0000000001000000, 0x0000000002000000, 0x0000000004000000, 0x0000000008000000,
	0x0000000010000000, 0x0000000020000000, 0x0000000040000000, 0x0000000080000000,
	0x0000000100000000, 0x0000000200000000, 0x0000000400000000, 0x0000000800000000,
	0x0000001000000000, 0x0000002000000000, 0x0000004000000000, 0x0000008000000000,
	0x0000010000000000, 0x0000020000000000, 0x0000040000000000, 0x0000080000000000,
	0x0000100000000000, 0x0000200000000000, 0x0000400000000000, 0x0000800000000000,
	0x0001000000000000, 0x0002000000000000, 0x0004000000000000, 0x0008000000000000,
	0x0010000000000000, 0x0020000000000000, 0x0040000000000000, 0x0080000000000000,
	0x0100000000000000, 0x0200000000000000, 0x0400000000000000, 0x0800000000000000,
	0x1000000000000000, 0x2000000000000000, 0x4000000000000000, 0x8000000000000000
};

const uint64_t T_BitDisable_Table[] ={
	~0x0000000000000001, ~0x0000000000000002, ~0x0000000000000004, ~0x0000000000000008,
	~0x0000000000000010, ~0x0000000000000020, ~0x0000000000000040, ~0x0000000000000080,
	~0x0000000000000100, ~0x0000000000000200, ~0x0000000000000400, ~0x0000000000000800,
	~0x0000000000001000, ~0x0000000000002000, ~0x0000000000004000, ~0x0000000000008000,
	~0x0000000000010000, ~0x0000000000020000, ~0x0000000000040000, ~0x0000000000080000,
	~0x0000000000100000, ~0x0000000000200000, ~0x0000000000400000, ~0x0000000000800000,
	~0x0000000001000000, ~0x0000000002000000, ~0x0000000004000000, ~0x0000000008000000,
	~0x0000000010000000, ~0x0000000020000000, ~0x0000000040000000, ~0x0000000080000000,
	~0x0000000100000000, ~0x0000000200000000, ~0x0000000400000000, ~0x0000000800000000,
	~0x0000001000000000, ~0x0000002000000000, ~0x0000004000000000, ~0x0000008000000000,
	~0x0000010000000000, ~0x0000020000000000, ~0x0000040000000000, ~0x0000080000000000,
	~0x0000100000000000, ~0x0000200000000000, ~0x0000400000000000, ~0x0000800000000000,
	~0x0001000000000000, ~0x0002000000000000, ~0x0004000000000000, ~0x0008000000000000,
	~0x0010000000000000, ~0x0020000000000000, ~0x0040000000000000, ~0x0080000000000000,
	~0x0100000000000000, ~0x0200000000000000, ~0x0400000000000000, ~0x0800000000000000,
	~0x1000000000000000, ~0x2000000000000000, ~0x4000000000000000, ~0x8000000000000000
};
// 98.304MHz/2/167 => 294323.3532934132 => 367.904
// New_BeatBaseCnt*Tempo = BeatBaseCnt*OriginalTempo, so
// New_BeatBaseCnt = BeatBaseCnt/Tempo * OriginalTempo = 368/Tempo * OriginalTempo,
// Table of 368/Tempo * 2^7

// 96 MHz/2/167 => 287425.149700 => 359.28


// New_BeatBaseCnt*Tempo = BeatBaseCnt*OriginalTempo, so
// New_BeatBaseCnt = BeatBaseCnt/Tempo * OriginalTempo = 352/Tempo * OriginalTempo,
// Table of 351.5625/Tempo * 2^7

#define C_BEAT_98304	47104	// 368*2^7
#define C_BEAT	      45988	// 359.28*2^7

const uint32_t T_TempoDivide[] ={
	C_BEAT/40,  C_BEAT/41,  C_BEAT/42,  C_BEAT/43,  C_BEAT/44,  C_BEAT/45,  C_BEAT/46,  C_BEAT/47,
	C_BEAT/48,  C_BEAT/49,  C_BEAT/50,  C_BEAT/51,  C_BEAT/52,  C_BEAT/53,  C_BEAT/54,  C_BEAT/55,
	C_BEAT/56,  C_BEAT/57,  C_BEAT/58,  C_BEAT/59,  C_BEAT/60,  C_BEAT/61,  C_BEAT/62,  C_BEAT/63,
	C_BEAT/64,  C_BEAT/65,  C_BEAT/66,  C_BEAT/67,  C_BEAT/68,  C_BEAT/69,  C_BEAT/70,  C_BEAT/71,
	C_BEAT/72,  C_BEAT/73,  C_BEAT/74,  C_BEAT/75,  C_BEAT/76,  C_BEAT/77,  C_BEAT/78,  C_BEAT/79,
	C_BEAT/80,  C_BEAT/81,  C_BEAT/82,  C_BEAT/83,  C_BEAT/84,  C_BEAT/85,  C_BEAT/86,  C_BEAT/87,
	C_BEAT/88,  C_BEAT/89,  C_BEAT/90,  C_BEAT/91,  C_BEAT/92,  C_BEAT/93,  C_BEAT/94,  C_BEAT/95,
	C_BEAT/96,  C_BEAT/97,  C_BEAT/98,  C_BEAT/99,  C_BEAT/100, C_BEAT/101, C_BEAT/102, C_BEAT/103,
	C_BEAT/104, C_BEAT/105, C_BEAT/106, C_BEAT/107, C_BEAT/108, C_BEAT/109, C_BEAT/110, C_BEAT/111,
	C_BEAT/112, C_BEAT/113, C_BEAT/114, C_BEAT/115, C_BEAT/116, C_BEAT/117, C_BEAT/118, C_BEAT/119,
	C_BEAT/120, C_BEAT/121, C_BEAT/122, C_BEAT/123, C_BEAT/124, C_BEAT/125, C_BEAT/126, C_BEAT/127,
	C_BEAT/128, C_BEAT/129, C_BEAT/130, C_BEAT/131, C_BEAT/132, C_BEAT/133, C_BEAT/134, C_BEAT/135,
	C_BEAT/136, C_BEAT/137, C_BEAT/138, C_BEAT/139, C_BEAT/140, C_BEAT/141, C_BEAT/142, C_BEAT/143,
	C_BEAT/144, C_BEAT/145, C_BEAT/146, C_BEAT/147, C_BEAT/148, C_BEAT/149, C_BEAT/150, C_BEAT/151,
	C_BEAT/152, C_BEAT/153, C_BEAT/154, C_BEAT/155, C_BEAT/156, C_BEAT/157, C_BEAT/158, C_BEAT/159,
	C_BEAT/160, C_BEAT/161, C_BEAT/162, C_BEAT/163, C_BEAT/164, C_BEAT/165, C_BEAT/166, C_BEAT/167,
	C_BEAT/168, C_BEAT/169, C_BEAT/170, C_BEAT/171, C_BEAT/172, C_BEAT/173, C_BEAT/174, C_BEAT/175,
	C_BEAT/176, C_BEAT/177, C_BEAT/178, C_BEAT/179, C_BEAT/180, C_BEAT/181, C_BEAT/182, C_BEAT/183,
	C_BEAT/184, C_BEAT/185, C_BEAT/186, C_BEAT/187, C_BEAT/188, C_BEAT/189, C_BEAT/190, C_BEAT/191,
	C_BEAT/192, C_BEAT/193, C_BEAT/194, C_BEAT/195, C_BEAT/196, C_BEAT/197, C_BEAT/198, C_BEAT/199,
	C_BEAT/200, C_BEAT/201, C_BEAT/202, C_BEAT/203, C_BEAT/204, C_BEAT/205, C_BEAT/206, C_BEAT/207,
	C_BEAT/208, C_BEAT/209, C_BEAT/210, C_BEAT/211, C_BEAT/212, C_BEAT/213, C_BEAT/214, C_BEAT/215,
	C_BEAT/216, C_BEAT/217, C_BEAT/218, C_BEAT/219, C_BEAT/220, C_BEAT/221, C_BEAT/222, C_BEAT/223,
	C_BEAT/224, C_BEAT/225, C_BEAT/226, C_BEAT/227, C_BEAT/228, C_BEAT/229, C_BEAT/230, C_BEAT/231,
	C_BEAT/232, C_BEAT/233, C_BEAT/234, C_BEAT/235, C_BEAT/236, C_BEAT/237, C_BEAT/238, C_BEAT/239,
	C_BEAT/240
};

const uint32_t T_TempoDivide_98304[] ={
	C_BEAT_98304/40,  C_BEAT_98304/41,  C_BEAT_98304/42,  C_BEAT_98304/43,  C_BEAT_98304/44,  C_BEAT_98304/45,  C_BEAT_98304/46,  C_BEAT_98304/47,
	C_BEAT_98304/48,  C_BEAT_98304/49,  C_BEAT_98304/50,  C_BEAT_98304/51,  C_BEAT_98304/52,  C_BEAT_98304/53,  C_BEAT_98304/54,  C_BEAT_98304/55,
	C_BEAT_98304/56,  C_BEAT_98304/57,  C_BEAT_98304/58,  C_BEAT_98304/59,  C_BEAT_98304/60,  C_BEAT_98304/61,  C_BEAT_98304/62,  C_BEAT_98304/63,
	C_BEAT_98304/64,  C_BEAT_98304/65,  C_BEAT_98304/66,  C_BEAT_98304/67,  C_BEAT_98304/68,  C_BEAT_98304/69,  C_BEAT_98304/70,  C_BEAT_98304/71,
	C_BEAT_98304/72,  C_BEAT_98304/73,  C_BEAT_98304/74,  C_BEAT_98304/75,  C_BEAT_98304/76,  C_BEAT_98304/77,  C_BEAT_98304/78,  C_BEAT_98304/79,
	C_BEAT_98304/80,  C_BEAT_98304/81,  C_BEAT_98304/82,  C_BEAT_98304/83,  C_BEAT_98304/84,  C_BEAT_98304/85,  C_BEAT_98304/86,  C_BEAT_98304/87,
	C_BEAT_98304/88,  C_BEAT_98304/89,  C_BEAT_98304/90,  C_BEAT_98304/91,  C_BEAT_98304/92,  C_BEAT_98304/93,  C_BEAT_98304/94,  C_BEAT_98304/95,
	C_BEAT_98304/96,  C_BEAT_98304/97,  C_BEAT_98304/98,  C_BEAT_98304/99,  C_BEAT_98304/100, C_BEAT_98304/101, C_BEAT_98304/102, C_BEAT_98304/103,
	C_BEAT_98304/104, C_BEAT_98304/105, C_BEAT_98304/106, C_BEAT_98304/107, C_BEAT_98304/108, C_BEAT_98304/109, C_BEAT_98304/110, C_BEAT_98304/111,
	C_BEAT_98304/112, C_BEAT_98304/113, C_BEAT_98304/114, C_BEAT_98304/115, C_BEAT_98304/116, C_BEAT_98304/117, C_BEAT_98304/118, C_BEAT_98304/119,
	C_BEAT_98304/120, C_BEAT_98304/121, C_BEAT_98304/122, C_BEAT_98304/123, C_BEAT_98304/124, C_BEAT_98304/125, C_BEAT_98304/126, C_BEAT_98304/127,
	C_BEAT_98304/128, C_BEAT_98304/129, C_BEAT_98304/130, C_BEAT_98304/131, C_BEAT_98304/132, C_BEAT_98304/133, C_BEAT_98304/134, C_BEAT_98304/135,
	C_BEAT_98304/136, C_BEAT_98304/137, C_BEAT_98304/138, C_BEAT_98304/139, C_BEAT_98304/140, C_BEAT_98304/141, C_BEAT_98304/142, C_BEAT_98304/143,
	C_BEAT_98304/144, C_BEAT_98304/145, C_BEAT_98304/146, C_BEAT_98304/147, C_BEAT_98304/148, C_BEAT_98304/149, C_BEAT_98304/150, C_BEAT_98304/151,
	C_BEAT_98304/152, C_BEAT_98304/153, C_BEAT_98304/154, C_BEAT_98304/155, C_BEAT_98304/156, C_BEAT_98304/157, C_BEAT_98304/158, C_BEAT_98304/159,
	C_BEAT_98304/160, C_BEAT_98304/161, C_BEAT_98304/162, C_BEAT_98304/163, C_BEAT_98304/164, C_BEAT_98304/165, C_BEAT_98304/166, C_BEAT_98304/167,
	C_BEAT_98304/168, C_BEAT_98304/169, C_BEAT_98304/170, C_BEAT_98304/171, C_BEAT_98304/172, C_BEAT_98304/173, C_BEAT_98304/174, C_BEAT_98304/175,
	C_BEAT_98304/176, C_BEAT_98304/177, C_BEAT_98304/178, C_BEAT_98304/179, C_BEAT_98304/180, C_BEAT_98304/181, C_BEAT_98304/182, C_BEAT_98304/183,
	C_BEAT_98304/184, C_BEAT_98304/185, C_BEAT_98304/186, C_BEAT_98304/187, C_BEAT_98304/188, C_BEAT_98304/189, C_BEAT_98304/190, C_BEAT_98304/191,
	C_BEAT_98304/192, C_BEAT_98304/193, C_BEAT_98304/194, C_BEAT_98304/195, C_BEAT_98304/196, C_BEAT_98304/197, C_BEAT_98304/198, C_BEAT_98304/199,
	C_BEAT_98304/200, C_BEAT_98304/201, C_BEAT_98304/202, C_BEAT_98304/203, C_BEAT_98304/204, C_BEAT_98304/205, C_BEAT_98304/206, C_BEAT_98304/207,
	C_BEAT_98304/208, C_BEAT_98304/209, C_BEAT_98304/210, C_BEAT_98304/211, C_BEAT_98304/212, C_BEAT_98304/213, C_BEAT_98304/214, C_BEAT_98304/215,
	C_BEAT_98304/216, C_BEAT_98304/217, C_BEAT_98304/218, C_BEAT_98304/219, C_BEAT_98304/220, C_BEAT_98304/221, C_BEAT_98304/222, C_BEAT_98304/223,
	C_BEAT_98304/224, C_BEAT_98304/225, C_BEAT_98304/226, C_BEAT_98304/227, C_BEAT_98304/228, C_BEAT_98304/229, C_BEAT_98304/230, C_BEAT_98304/231,
	C_BEAT_98304/232, C_BEAT_98304/233, C_BEAT_98304/234, C_BEAT_98304/235, C_BEAT_98304/236, C_BEAT_98304/237, C_BEAT_98304/238, C_BEAT_98304/239,
	C_BEAT_98304/240
};

//2^16 * 2^19 / (287425.1497)    65536*524288/287425.15
//2^16 * 2^19 / SERVICE_RATE
const uint32_t T_VarPhaseTableBottom[] ={		//for step 65536
      467,      495,      524,      555,      588,      623,      660,      700,
      741,      785,      832,      882,      934,      989,     1048,     1111,
     1177,     1247,     1321,     1399,     1483,     1571,     1664,     1763,
     1868,     1979,     2097,     2221,     2353,     2493,     2642,     2799,
     2965,     3141,     3328,     3526,     3736,     3958,     4193,     4443,
     4707,     4987,     5283,     5597,     5930,     6283,     6656,     7052,
     7471,     7916,     8386,     8885,     9413,     9973,    10566,    11195,
    11860,    12565,    13313,    14104,    14943,    15831,    16773,    17770,
    18827,    19946,    21132,    22389,    23720,    25131,    26625,    28208,
    29886,    31663,    33546,    35540,    37654,    39893,    42265,    44778,
    47441,    50262,    53250,    56417,    59772,    63326,    67091,    71081,
    75308,    79786,    84530,    89556,    94882,   100523,   106501,   112834,
   119543,                                                                            // const uint32_t T_VarPhaseTable
   126652,   134183,   142162,   150615,   159571,   169060,   179113,   189763,      // +1 ~ +8
   201047,   213002,   225668,   239087,   253303,   268366,   284323,   301230,      // +9 ~ +16
   319142,   338119,   358225,   379526,   402094,   426004,   451335,   478173,      // +17 ~ +24
   506607,   536731,   568647,   602460,   638284,   676239,   716450,   759052,      // +25 ~ +32
   804188,   852007,   902670,   956346,  1013213,  1073462,  1137294,  1204921,      // +33 ~ +40
  1276569,  1352478,  1432900,  1518105,  1608376,  1704015,  1805341,  1912692,      // +41 ~ +48
  2026427,  2146924,  2274587,  2409841,  2553138,  2704955,  2865800,  3036209,      // +49 ~ +56
  3216752,  3408030,  3610682,  3825384,  4052853,  4293849,  4549174,  4819682,      // +57 ~ +64
  5106275,  5409910,  5731600,  6072419,  6433504,  6816060,  7221364,  7650768       // +65 ~ +72
};
#define T_VarPhaseTable T_VarPhaseTableBottom + 96

//2^16 * 2^19 / (294323.3532934132)    65536*524288/294323.3532934132
//2^16 * 2^19 / SERVICE_RATE
const uint32_t T_VarPhaseTableBottom_98304[] ={		//for step 65536
      456,      483,      512,      542,      575,      609,      645,      683,
      724,      767,      813,      861,      912,      966,     1024,     1085,
     1149,     1217,     1290,     1367,     1448,     1534,     1625,     1722,
     1824,     1933,     2047,     2169,     2298,     2435,     2580,     2733,
     2896,     3068,     3250,     3443,     3648,     3865,     4095,     4338,
     4596,     4870,     5159,     5466,     5791,     6135,     6500,     6887,
     7296,     7730,     8190,     8677,     9193,     9739,    10319,    10932,
    11582,    12271,    13001,    13774,    14593,    15460,    16380,    17354,
    18386,    19479,    20637,    21864,    23164,    24542,    26001,    27547,
    29185,    30921,    32759,    34707,    36771,    38958,    41274,    43729,
    46329,    49084,    52002,    55095,    58371,    61842,    65519,    69415,
    73543,    77916,    82549,    87457,    92658,    98167,   104005,   110189,
   116741,                                                                            // const uint32_t T_VarPhaseTable
   123683,   131038,   138830,   147085,   155831,   165097,   174915,   185316,      // +1 ~ +8
   196335,   208010,   220379,   233483,   247367,   262076,   277660,   294170,      // +9 ~ +16
   311662,   330195,   349829,   370631,   392670,   416019,   440757,   466966,      // +17 ~ +24
   494733,   524151,   555319,   588340,   623325,   660389,   699658,   741262,      // +25 ~ +32
   785340,   832039,   881514,   933932,   989466,  1048303,  1110638,  1176680,      // +33 ~ +40
  1246649,  1320779,  1399316,  1482524,  1570680,  1664077,  1763028,  1867863,      // +41 ~ +48
  1978932,  2096606,  2221276,  2353360,  2493298,  2641558,  2798633,  2965048,      // +49 ~ +56
  3141359,  3328154,  3526057,  3735727,  3957865,  4193212,  4442553,  4706721,      // +57 ~ +64
  4986597,  5283115,  5597266,  5930097,  6282718,  6656308,  7052113,  7471454       // +65 ~ +72
};

#define T_VarPhaseTable_98304 T_VarPhaseTableBottom_98304 + 96

//*****************************************************************************
//							Pitch Bend Table
//*****************************************************************************
//2^14*2^(-1/12)*(2^(-1/12))^(-n/64)
//2^14 Middle
//2^14*2^(1/12)*(2^(1/12))^(n/64)
const uint32_t T_PitchWheelTable[] ={
	15464, 15478, 15492, 15506, 15520, 15534, 15548, 15562,
	15576, 15590, 15604, 15618, 15632, 15646, 15661, 15675,
	15689, 15703, 15717, 15731, 15746, 15760, 15774, 15788,
	15803, 15817, 15831, 15845, 15860, 15874, 15888, 15903,
	15917, 15931, 15946, 15960, 15975, 15989, 16004, 16018,
	16032, 16047, 16061, 16076, 16090, 16105, 16119, 16134,
	16149, 16163, 16178, 16192, 16207, 16222, 16236, 16251,
	16266, 16280, 16295, 16310, 16324, 16339, 16354, 16369,
	16384, 16398, 16413, 16428, 16443, 16458, 16472, 16487,
	16502, 16517, 16532, 16547, 16562, 16577, 16592, 16607,
	16622, 16637, 16652, 16667, 16682, 16697, 16712, 16727,
	16742, 16757, 16773, 16788, 16803, 16818, 16833, 16848,
	16864, 16879, 16894, 16909, 16925, 16940, 16955, 16970,
	16986, 17001, 17016, 17032, 17047, 17063, 17078, 17093,
	17109, 17124, 17140, 17155, 17171, 17186, 17202, 17217,
	17233, 17248, 17264, 17280, 17295, 17311, 17326, 17342,
	17358
};
//==================================================================

//2^14*2^(-2/12)*(2^(-2/12))^(-n/64)
//2^14 Middle
//2^14*2^(2/12)*(2^(2/12))^(n/64)
const uint32_t T_PitchWheelTable_TWO[] ={
	14596, 14623, 14649, 14676, 14702, 14729, 14755, 14782,
	14809, 14836, 14862, 14889, 14916, 14943, 14970, 14997,
	15024, 15051, 15079, 15106, 15133, 15160, 15188, 15215,
	15243, 15270, 15298, 15325, 15353, 15381, 15409, 15437,
	15464, 15492, 15520, 15548, 15576, 15605, 15633, 15661,
	15689, 15718, 15746, 15775, 15803, 15832, 15860, 15889,
	15918, 15946, 15975, 16004, 16033, 16062, 16091, 16120,
	16149, 16178, 16208, 16237, 16266, 16296, 16325, 16354,
	16384, 16414, 16443, 16473, 16503, 16533, 16562, 16592,
	16622, 16652, 16682, 16713, 16743, 16773, 16803, 16834,
	16864, 16895, 16925, 16956, 16986, 17017, 17048, 17079,
	17109, 17140, 17171, 17202, 17233, 17264, 17296, 17327,
	17358, 17390, 17421, 17452, 17484, 17516, 17547, 17579,
	17611, 17643, 17674, 17706, 17738, 17770, 17802, 17835,
	17867, 17899, 17931, 17964, 17996, 18029, 18061, 18094,
	18127, 18160, 18192, 18225, 18258, 18291, 18324, 18357,
	18390
};


